<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMS MML ç®¡ç†ç»ˆç«¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }

        #container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        #main-area {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* æ‹–åŠ¨åˆ†éš”æ¡æ ·å¼ */
        .resizer {
            background: #3e3e42;
            cursor: col-resize;
            width: 4px;
            position: relative;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .resizer:hover {
            background: #667eea;
        }
        
        .resizer:hover .toggle-panel-btn {
            opacity: 1;
        }
        
        .resizer-horizontal {
            cursor: row-resize;
            height: 4px;
            width: 100%;
        }

        /* å¤´éƒ¨ */
        #header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            height: 50px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        #header h1 {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        #header .status {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* å·¦ä¾§å‘½ä»¤æ ‘ */
        #command-tree-panel {
            background: #252526;
            overflow-y: auto;
            overflow-x: hidden;
            width: 280px;
            min-width: 200px;
            max-width: 600px;
            transition: width 0.3s ease, min-width 0.3s ease;
        }
        
        #command-tree-panel.collapsed {
            display: none;
        }

        .tree-header {
            padding: 15px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .tree-header h3 {
            font-size: 14px;
            color: #cccccc;
            margin-bottom: 10px;
        }

        #tree-search {
            width: 100%;
            padding: 8px;
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 3px;
            color: #d4d4d4;
            font-size: 12px;
        }

        #tree-search:focus {
            outline: none;
            border-color: #007acc;
        }

        .tree-category {
            margin: 5px 0;
        }

        .category-header {
            padding: 10px 15px;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .category-header:hover {
            background: #2d2d30;
        }

        .category-icon {
            font-size: 16px;
        }

        .category-name {
            font-size: 13px;
            font-weight: 500;
        }

        .category-toggle {
            margin-left: auto;
            transition: transform 0.2s;
        }

        .category-toggle.expanded {
            transform: rotate(90deg);
        }

        .category-commands {
            display: none;
            background: #1e1e1e;
        }

        .category-commands.show {
            display: block;
        }

        .command-item {
            padding: 8px 15px 8px 40px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .command-item:hover {
            background: #094771;
        }

        .command-item.selected {
            background: #0e639c;
        }

        /* ä¸­é—´é¢æ¿ */
        #middle-panel {
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
            min-height: 0;
            flex: 1;
            min-width: 400px;
        }

        /* è¾“å‡ºåŒºåŸŸ */
        #output-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
            min-height: 0;
        }
        
        /* è¾“å‡ºé¡µç­¾ */
        #output-tabs {
            display: flex;
            gap: 2px;
            background: #1e1e1e;
            padding: 5px 15px 0;
            border-bottom: 1px solid #3e3e42;
            flex-shrink: 0;
        }
        
        .output-tab {
            background: #2d2d30;
            color: #969696;
            border: none;
            padding: 8px 20px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 4px 4px 0 0;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }
        
        .output-tab:hover {
            background: #3c3c3c;
            color: #cccccc;
        }
        
        .output-tab.active {
            background: #1e1e1e;
            color: #4ec9b0;
            border-bottom-color: #4ec9b0;
        }
        
        /* è¾“å‡ºå†…å®¹åŒºåŸŸ */
        #output-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 0;
        }
        
        /* å†å²è®°å½•åŒºåŸŸ */
        #history-content {
            flex: 1;
            display: none;
            flex-direction: column;
            min-height: 0;
        }
        
        #history-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-size: 13px;
            min-height: 0;
        }
        
        #history-detail {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-size: 13px;
            background: #1a1a1a;
            border-top: 1px solid #3e3e42;
            display: none;
            min-height: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
        }
        
        #history-detail.show {
            display: block;
        }
        
        #history-detail .output-entry {
            color: #d4d4d4;
        }
        
        .history-item {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 10px 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .history-item:hover {
            background: #3c3c3c;
            border-color: #4ec9b0;
        }
        
        .history-item.selected {
            background: #3c3c3c;
            border-color: #4ec9b0;
        }
        
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .history-item-command {
            color: #4ec9b0;
            font-weight: 500;
        }
        
        .history-item-time {
            color: #858585;
            font-size: 11px;
        }
        
        .history-item-result {
            color: #d4d4d4;
            font-size: 12px;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #output-content {
            color: #d4d4d4;
        }

        .output-entry {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .output-command {
            color: #4ec9b0;
            margin-bottom: 5px;
        }

        .output-time {
            color: #858585;
            font-size: 11px;
            margin-bottom: 5px;
        }

        .output-result {
            color: #d4d4d4;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .output-error {
            color: #f48771;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .output-success {
            color: #4ade80;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* è¾“å…¥åŒºåŸŸ */
        #input-area {
            background: #252526;
            padding: 10px 15px;
            height: 33vh;  /* é»˜è®¤å é¡µé¢é«˜åº¦çš„ä¸‰åˆ†ä¹‹ä¸€ */
            min-height: 50px;
            max-height: 600px;  /* å¢åŠ åˆ° 600pxï¼Œå…è®¸æ›´å¤šå‚æ•°æ˜¾ç¤º */
            display: flex;  /* ä½¿ç”¨ flex å¸ƒå±€ */
            flex-direction: column;  /* å‚ç›´æ’åˆ— */
        }

        #command-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 3px;
            padding: 5px 10px;
            position: relative;
            flex-shrink: 0;  /* é˜²æ­¢å‘½ä»¤è¾“å…¥æ¡†è¢«å‹ç¼© */
        }
        
        /* å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ä¸‹æ‹‰èœå• */
        #autocomplete-dropdown {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: #2d2d30;
            border: 1px solid #555;
            border-bottom: none;
            border-radius: 3px 3px 0 0;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }
        
        .autocomplete-item {
            padding: 8px 15px;
            cursor: pointer;
            color: #d4d4d4;
            border-bottom: 1px solid #3e3e42;
        }
        
        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: #094771;
        }
        
        .autocomplete-item .command-name {
            color: #4ec9b0;
            font-weight: bold;
        }
        
        .autocomplete-item .command-desc {
            color: #858585;
            font-size: 11px;
            margin-left: 10px;
        }

        #command-input-wrapper.focused {
            border-color: #007acc;
        }
        
        /* å‚æ•°è¾“å…¥è¡¨å•æ ·å¼ */
        #param-form {
            margin-top: 10px;
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 3px;
            padding: 10px;
            flex: 1;  /* è‡ªåŠ¨å¡«å…… input-area çš„å‰©ä½™ç©ºé—´ */
            min-height: 0;  /* å…è®¸ç¼©å°åˆ°å†…å®¹é«˜åº¦ */
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;  /* ä¿æŒæ»šåŠ¨æ¡ */
        }
        
        /* å‚æ•°è¡¨å•æ‹–åŠ¨æ¡ï¼ˆå·²ç¦ç”¨ï¼Œå› ä¸ºä½¿ç”¨ flex: 1 è‡ªåŠ¨å¡«å……ï¼‰ */
        .param-form-resizer {
            display: none;  /* éšè—æ‹–åŠ¨æ¡ */
        }
        
        .param-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #3e3e42;
        }
        
        .param-form-title {
            color: #4ec9b0;
            font-weight: bold;
            font-size: 12px;
        }
        
        .param-form-close {
            background: none;
            border: none;
            color: #858585;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            border-radius: 3px;
        }
        
        .param-form-close:hover {
            background: #3e3e42;
            color: #d4d4d4;
        }
        
        #param-form-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            padding-top: 5px;
            /* ç§»é™¤ overflow-y å’Œ flex: 1ï¼Œè®©å†…å®¹è‡ªé€‚åº”é«˜åº¦ */
        }
        
        .param-field {
            display: flex;
            flex-direction: column;
        }
        
        .param-field label {
            color: #d4d4d4;
            font-size: 11px;
            margin-bottom: 4px;
        }
        
        .param-field .required {
            color: #f48771;
        }
        
        .param-field input,
        .param-field select {
            background: #3c3c3c;
            border: 1px solid #555;
            color: #d4d4d4;
            padding: 6px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }
        
        .param-field input:focus,
        .param-field select:focus {
            outline: none;
            border-color: #007acc;
        }

        .input-prompt {
            color: #4ec9b0;
            font-weight: bold;
        }

        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #d4d4d4;
            font-family: inherit;
            font-size: 13px;
            outline: none;
        }

        .execute-btn {
            background: #0e639c;
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .execute-btn:hover {
            background: #1177bb;
        }

        .execute-btn:active {
            background: #0d5789;
        }

        /* å³ä¾§æ—¥å¿—é¢æ¿ */
        #log-panel {
            background: #252526;
            display: flex;
            flex-direction: column;
            min-height: 0;
            width: 350px;
            min-width: 250px;
            max-width: 800px;
            transition: width 0.3s ease, min-width 0.3s ease;
        }
        
        #log-panel.collapsed {
            display: none;
        }
        
        .resizer.collapsed {
            display: none;
        }
        
        /* æµ®åŠ¨å±•å¼€æŒ‰é’® */
        .floating-expand-btn {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            background: #2d2d30;
            border: 1px solid #4ec9b0;
            color: #4ec9b0;
            padding: 8px 4px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            opacity: 0.3;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            display: none;
        }
        
        .floating-expand-btn:hover {
            background: #4ec9b0;
            color: #1e1e1e;
            opacity: 1;
            transform: translateY(-50%) scale(1.1);
        }
        
        #left-expand-btn {
            left: 0;
        }
        
        #right-expand-btn {
            right: 0;
        }
        
        #left-expand-btn.show,
        #right-expand-btn.show {
            display: block;
        }

        .log-header {
            padding: 15px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-header h3 {
            font-size: 14px;
            color: #cccccc;
        }

        .log-controls {
            display: flex;
            gap: 5px;
        }

        .log-btn {
            background: #3c3c3c;
            border: 1px solid #555;
            color: #d4d4d4;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }

        .log-btn:hover {
            background: #4a4a4a;
        }
        
        /* æ”¶èµ·/å±•å¼€æŒ‰é’®æ ·å¼ï¼ˆåœ¨æ‹–åŠ¨æ¡ä¸Šï¼‰*/
        .toggle-panel-btn {
            background: #2d2d30;
            border: 1px solid #4ec9b0;
            color: #4ec9b0;
            padding: 4px 2px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 10px;
            line-height: 1;
            transition: all 0.2s ease;
            opacity: 0.2;
            position: absolute;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
            width: 16px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toggle-panel-btn:hover {
            background: #4ec9b0;
            color: #1e1e1e;
            opacity: 1;
            transform: scale(1.05);
        }
        
        /* è¡¥å…¨æŒ‰é’®æ ·å¼ */
        /* å†å²å¯¼èˆªæŒ‰é’® */
        .history-nav-btn {
            background: #3c3c3c;
            border: 1px solid #555;
            color: #cccccc;
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
        }
        
        .history-nav-btn:hover:not(:disabled) {
            background: #4a4a4a;
            border-color: #4ec9b0;
            color: #4ec9b0;
        }
        
        .history-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .parse-btn {
            background: #3c3c3c;
            border: 1px solid #555;
            color: #9cdcfe;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .parse-btn:hover {
            background: #4a4a4a;
            border-color: #9cdcfe;
            transform: translateY(-1px);
        }
        
        .parse-btn:active {
            transform: translateY(0);
        }

        #log-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-size: 11px;
            line-height: 1.5;
            min-height: 0; /* ç¡®ä¿ flex å­å…ƒç´ å¯ä»¥æ»šåŠ¨ */
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 3px 5px;
            border-left: 2px solid transparent;
        }

        .log-entry.DEBUG {
            color: #858585;
            border-left-color: #858585;
        }

        .log-entry.INFO {
            color: #4ec9b0;
            border-left-color: #4ec9b0;
        }

        .log-entry.WARNING {
            color: #dcdcaa;
            border-left-color: #dcdcaa;
        }

        .log-entry.ERROR {
            color: #f48771;
            border-left-color: #f48771;
        }

        .log-time {
            color: #858585;
            margin-right: 5px;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #424242;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4e4e4e;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #4ec9b0;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* å“åº”å¼ */
        @media (max-width: 1024px) {
            #command-tree-panel {
                width: 250px;
            }
            #log-panel {
                width: 300px;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <!-- å¤´éƒ¨ -->
        <div id="header">
            <h1>ğŸ–¥ï¸ IMS MML ç®¡ç†ç»ˆç«¯</h1>
            <div class="status">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span>æœåŠ¡è¿è¡Œä¸­</span>
                </div>
                <div class="status-indicator">
                    <span id="time"></span>
                </div>
            </div>
        </div>

        <!-- æµ®åŠ¨å±•å¼€æŒ‰é’® -->
        <button class="floating-expand-btn" id="left-expand-btn" title="å±•å¼€å‘½ä»¤ç›®å½•">â–¶</button>
        <button class="floating-expand-btn" id="right-expand-btn" title="å±•å¼€æ—¥å¿—é¢æ¿">â—€</button>
        
        <!-- ä¸»åŒºåŸŸ -->
        <div id="main-area">
        <!-- å·¦ä¾§å‘½ä»¤æ ‘ -->
        <div id="command-tree-panel">
            <div class="tree-header">
                <h3>ğŸ“š å‘½ä»¤ç›®å½•</h3>
                <input type="text" id="tree-search" placeholder="æœç´¢å‘½ä»¤...">
            </div>
            <div id="command-tree"></div>
        </div>

        <!-- å·¦ä¾§æ‹–åŠ¨åˆ†éš”æ¡ -->
        <div class="resizer" id="left-resizer">
            <button class="toggle-panel-btn" id="toggle-left-panel" title="æ”¶èµ·/å±•å¼€å‘½ä»¤ç›®å½•">â—€</button>
        </div>

        <!-- ä¸­é—´é¢æ¿ -->
        <div id="middle-panel">
            <!-- è¾“å‡ºåŒºåŸŸ -->
            <div id="output-area">
                <!-- é¡µç­¾ -->
                <div id="output-tabs">
                    <button class="output-tab active" id="current-tab">å½“å‰å›æ˜¾</button>
                    <button class="output-tab" id="history-tab">å†å²è®°å½•</button>
                </div>
                
                <!-- å½“å‰å›æ˜¾å†…å®¹ -->
                <div id="output-content">
                    <div class="output-entry">
                        <div class="output-time">ç³»ç»Ÿæ—¶é—´: <span id="welcome-time"></span></div>
                        <div class="output-result">
æ¬¢è¿ä½¿ç”¨ IMS MML ç®¡ç†ç»ˆç«¯
=================================================================

å‘½ä»¤æ ¼å¼: VERB OBJECT [PARAM1=VALUE1] [PARAM2=VALUE2] ...

å¿«é€Ÿå¼€å§‹:
  DSP SYSINFO           - æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯
  DSP REG ALL           - æŸ¥çœ‹æ³¨å†Œåˆ—è¡¨
  DSP CALL ACTIVE       - æŸ¥çœ‹æ´»è·ƒå‘¼å«
  HELP ALL              - æ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤å¸®åŠ©

æç¤º: å·¦ä¾§å¯é€‰æ‹©å‘½ä»¤ï¼Œæˆ–åœ¨ä¸‹æ–¹ç›´æ¥è¾“å…¥
=================================================================
                        </div>
                    </div>
                    <!-- æ»šåŠ¨é”šç‚¹ï¼šç”¨äºå¯é çš„è‡ªåŠ¨æ»šåŠ¨ -->
                    <div id="output-anchor" style="height: 1px;"></div>
                </div>
                
                <!-- å†å²è®°å½•å†…å®¹ -->
                <div id="history-content">
                    <!-- å†å²åˆ—è¡¨ -->
                    <div id="history-list">
                        <p style="color: #858585; text-align: center; margin-top: 50px;">æš‚æ— å†å²è®°å½•</p>
                    </div>
                    <!-- å†å²è¯¦æƒ… -->
                    <div id="history-detail">
                        <p style="color: #858585; text-align: center; margin-top: 50px;">è¯·é€‰æ‹©ä¸€æ¡å†å²è®°å½•æŸ¥çœ‹è¯¦æƒ…</p>
                    </div>
                </div>
            </div>

            <!-- æ°´å¹³æ‹–åŠ¨åˆ†éš”æ¡ -->
            <div class="resizer resizer-horizontal" id="horizontal-resizer"></div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div id="input-area">
                <div id="command-input-wrapper">
                    <!-- è‡ªåŠ¨è¡¥å…¨ä¸‹æ‹‰æ¡† -->
                    <div id="autocomplete-dropdown"></div>
                    <span class="input-prompt">MML></span>
                    <input type="text" id="command-input" placeholder="è¾“å…¥ MML å‘½ä»¤..." autocomplete="off">
                    <button class="history-nav-btn" id="history-prev-btn" title="ä¸Šä¸€æ¡å†å²å‘½ä»¤ (â†‘)">â†</button>
                    <button class="history-nav-btn" id="history-next-btn" title="ä¸‹ä¸€æ¡å†å²å‘½ä»¤ (â†“)">â†’</button>
                    <button class="parse-btn" id="parse-btn" title="è§£æå‘½ä»¤å¹¶è¡¥å…¨åˆ°å‚æ•°è¡¨å•">è¡¥å…¨</button>
                    <button class="execute-btn" id="execute-btn">æ‰§è¡Œ</button>
                </div>
                <!-- å‚æ•°è¾“å…¥è¡¨å•ï¼ˆæ ¹æ®å‘½ä»¤è‡ªåŠ¨æ˜¾ç¤º/éšè—ï¼‰ -->
                <div id="param-form" style="display: none;">
                    <!-- æ‹–åŠ¨æ¡ -->
                    <div class="param-form-resizer" id="param-form-resizer"></div>
                    <div class="param-form-header">
                        <span class="param-form-title">å‘½ä»¤å‚æ•°</span>
                    </div>
                    <div id="param-form-fields"></div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§æ‹–åŠ¨åˆ†éš”æ¡ -->
        <div class="resizer" id="right-resizer">
            <button class="toggle-panel-btn" id="toggle-right-panel" title="æ”¶èµ·/å±•å¼€æ—¥å¿—é¢æ¿">â–¶</button>
        </div>

        <!-- å³ä¾§æ—¥å¿—é¢æ¿ -->
        <div id="log-panel">
            <div class="log-header">
                <h3>ğŸ“‹ å®æ—¶æ—¥å¿—</h3>
                <div class="log-controls">
                    <button class="log-btn" id="clear-log-btn">æ¸…ç©º</button>
                    <button class="log-btn" id="pause-log-btn">æš‚åœ</button>
                </div>
            </div>
            <div id="log-content">
                <div class="log-entry INFO">
                    <span class="log-time" id="log-start-time"></span>
                    <span>æ—¥å¿—ç³»ç»Ÿå·²å¯åŠ¨</span>
                </div>
                <!-- æ»šåŠ¨é”šç‚¹ï¼šç”¨äºå¯é çš„è‡ªåŠ¨æ»šåŠ¨ -->
                <div id="log-anchor" style="height: 1px;"></div>
            </div>
        </div>
        </div> <!-- ç»“æŸ main-area -->
    </div> <!-- ç»“æŸ container -->

    <script>
        // å…¨å±€å˜é‡
        let commandHistory = [];
        let historyIndex = -1;
        let logPaused = false;
        let ws = null;
        let autocompleteIndex = -1;
        let allCommands = [];  // å­˜å‚¨æ‰€æœ‰å‘½ä»¤ç”¨äºè‡ªåŠ¨è¡¥å…¨

        // åˆå§‹åŒ–æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', { hour12: false });
            document.getElementById('time').textContent = timeStr;
            
            if (!document.getElementById('welcome-time').textContent) {
                document.getElementById('welcome-time').textContent = timeStr;
                document.getElementById('log-start-time').textContent = timeStr;
            }
        }
        updateTime();
        setInterval(updateTime, 1000);

        // åŠ è½½å‘½ä»¤æ ‘
        async function loadCommandTree() {
            try {
                const response = await fetch('/api/command_tree');
                const tree = await response.json();
                renderCommandTree(tree);
                
                // æ”¶é›†æ‰€æœ‰å‘½ä»¤ç”¨äºè‡ªåŠ¨è¡¥å…¨
                allCommands = [];
                for (const [category, data] of Object.entries(tree)) {
                    for (const [name, cmd] of Object.entries(data.commands)) {
                        allCommands.push({
                            name: name,
                            command: cmd,
                            category: category
                        });
                    }
                }
            } catch (error) {
                console.error('åŠ è½½å‘½ä»¤æ ‘å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“å‘½ä»¤æ ‘
        function renderCommandTree(tree) {
            const container = document.getElementById('command-tree');
            container.innerHTML = '';

            for (const [category, data] of Object.entries(tree)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'tree-category';

                // åˆ†ç±»å¤´éƒ¨
                const header = document.createElement('div');
                header.className = 'category-header';
                header.innerHTML = `
                    <span class="category-icon">${data.icon || 'ğŸ“'}</span>
                    <span class="category-name">${category}</span>
                    <span class="category-toggle">â–¶</span>
                `;

                // å‘½ä»¤åˆ—è¡¨
                const commandsDiv = document.createElement('div');
                commandsDiv.className = 'category-commands';

                for (const [name, cmd] of Object.entries(data.commands)) {
                    const cmdItem = document.createElement('div');
                    cmdItem.className = 'command-item';
                    cmdItem.textContent = name;
                    cmdItem.title = cmd;
                    cmdItem.dataset.command = cmd;

                    cmdItem.addEventListener('click', () => {
                        document.getElementById('command-input').value = cmd;
                        document.querySelectorAll('.command-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        cmdItem.classList.add('selected');
                        document.getElementById('command-input').focus();
                        
                        // è§¦å‘å‚æ•°è¡¨å•æ£€æŸ¥
                        checkAndShowParamForm();
                    });

                    commandsDiv.appendChild(cmdItem);
                }

                // æŠ˜å /å±•å¼€
                header.addEventListener('click', () => {
                    const toggle = header.querySelector('.category-toggle');
                    if (commandsDiv.classList.contains('show')) {
                        commandsDiv.classList.remove('show');
                        toggle.classList.remove('expanded');
                    } else {
                        commandsDiv.classList.add('show');
                        toggle.classList.add('expanded');
                    }
                });

                categoryDiv.appendChild(header);
                categoryDiv.appendChild(commandsDiv);
                container.appendChild(categoryDiv);
            }
        }

        // å†å²è®°å½•è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…å«å‘½ä»¤å’Œç»“æœï¼‰
        const commandHistoryDetails = [];
        
        // æ‰§è¡Œå‘½ä»¤
        async function executeCommand() {
            const input = document.getElementById('command-input');
            const command = input.value.trim();

            if (!command) return;

            // æ·»åŠ åˆ°å†å²
            commandHistory.unshift(command);
            historyIndex = -1;

            // æ˜¾ç¤ºå‘½ä»¤
            appendOutput(command, 'æ‰§è¡Œä¸­...', 'pending');

            try {
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ command })
                });

                const result = await response.json();

                // æ˜¾ç¤ºç»“æœ
                appendOutput(command, result.output, result.retcode === 0 ? 'success' : 'error', result.timestamp);
                
                // ä¿å­˜åˆ°å†å²è®°å½•è¯¦æƒ…
                commandHistoryDetails.unshift({
                    id: Date.now(),
                    command: command,
                    output: result.output,
                    status: result.retcode === 0 ? 'success' : 'error',
                    timestamp: result.timestamp || new Date().toLocaleString('zh-CN')
                });
                
                // âœ… é™åˆ¶å†å²è®°å½•æ•°é‡ï¼Œé˜²æ­¢å†…å­˜æ— é™å¢é•¿
                const maxHistoryCount = 100;
                if (commandHistoryDetails.length > maxHistoryCount) {
                    commandHistoryDetails.splice(maxHistoryCount);
                }
                
                // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
                updateHistoryDisplay();
                
                // æ›´æ–°å†å²æŒ‰é’®çŠ¶æ€
                updateHistoryButtons();

                // æ¸…ç©ºè¾“å…¥
                input.value = '';

            } catch (error) {
                appendOutput(command, `æ‰§è¡Œå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ·»åŠ è¾“å‡º
        function appendOutput(command, output, type, timestamp) {
            const outputContent = document.getElementById('output-content');
            const outputAnchor = document.getElementById('output-anchor');
            
            const entry = document.createElement('div');
            entry.className = 'output-entry';

            const timeStr = timestamp || new Date().toLocaleString('zh-CN', { hour12: false });

            entry.innerHTML = `
                <div class="output-command">MML> ${escapeHtml(command)}</div>
                <div class="output-time">${timeStr}</div>
                <div class="output-result ${type === 'error' ? 'output-error' : type === 'success' ? 'output-success' : ''}">${escapeHtml(output)}</div>
            `;

            // æ’å…¥åˆ°é”šç‚¹ä¹‹å‰
            outputContent.insertBefore(entry, outputAnchor);

            // é™åˆ¶è¾“å‡ºæ¡æ•°ï¼Œä¿ç•™æœ€è¿‘ 1000 æ¡ï¼ˆé˜²æ­¢é¡µé¢å¡æ­»ï¼‰
            const maxEntries = 1000;
            const entries = outputContent.querySelectorAll('.output-entry');
            if (entries.length > maxEntries) {
                // åˆ é™¤æœ€æ—§çš„æ¡ç›®ï¼ˆä»å‰é¢å¼€å§‹åˆ é™¤ï¼‰
                const deleteCount = entries.length - maxEntries;
                for (let i = 0; i < deleteCount; i++) {
                    if (entries[i]) {  // âœ… æ·»åŠ å®‰å…¨æ£€æŸ¥
                        entries[i].remove();
                    }
                }
            }

            // æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆä¿®æ­£ï¼šæ»šåŠ¨ outputContent è€Œä¸æ˜¯ outputAreaï¼‰
            // ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–æ€§èƒ½
            requestAnimationFrame(() => {
                outputContent.scrollTop = outputContent.scrollHeight;
            });
        }

        // HTML è½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ·»åŠ æ—¥å¿—ï¼ˆæ”¯æŒä¸­æ–‡æ—¥å¿—å’ŒWebSocketæ—¥å¿—ï¼‰
        // æ»šåŠ¨èŠ‚æµæ ‡å¿—
        let logScrollPending = false;
        
        function appendLog(message, level = 'INFO') {
            if (logPaused) return;

            const logContent = document.getElementById('log-content');
            const logAnchor = document.getElementById('log-anchor');
            
            const entry = document.createElement('div');
            entry.className = `log-entry ${level}`;

            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', { hour12: false });

            // å°†è‹±æ–‡æ—¥å¿—è½¬æ¢ä¸ºä¸­æ–‡ï¼ˆå¯é€‰ï¼‰
            const displayMessage = translateLogMessage(message);

            entry.innerHTML = `
                <span class="log-time">${timeStr}</span>
                <span>${escapeHtml(displayMessage)}</span>
            `;

            // æ’å…¥åˆ°é”šç‚¹ä¹‹å‰
            logContent.insertBefore(entry, logAnchor);

            // é™åˆ¶æ—¥å¿—æ¡æ•°ï¼ˆä½†ä¿ç•™é”šç‚¹ï¼‰
            // âœ… ä¿®å¤ï¼šä½¿ç”¨ for å¾ªç¯æ›¿ä»£ while å¾ªç¯ï¼Œé¿å…é™æ€ NodeList å¯¼è‡´çš„è¿‡åº¦åˆ é™¤
            const maxLogEntries = 500;
            const entries = logContent.querySelectorAll('.log-entry');
            if (entries.length > maxLogEntries) {
                const deleteCount = entries.length - maxLogEntries;
                for (let i = 0; i < deleteCount; i++) {
                    if (entries[i]) {
                        entries[i].remove();
                    }
                }
            }

            // æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆä½¿ç”¨ requestAnimationFrame èŠ‚æµï¼‰
            if (!logPaused && !logScrollPending) {
                logScrollPending = true;
                requestAnimationFrame(() => {
                    logContent.scrollTop = logContent.scrollHeight;
                    logScrollPending = false;
                });
            }
        }
        
        // å°†è‹±æ–‡æ—¥å¿—è½¬æ¢ä¸ºä¸­æ–‡æè¿°
        function translateLogMessage(message) {
            const translations = {
                'UDP server listening on': 'UDP æœåŠ¡å™¨ç›‘å¬',
                'Started all SIP timers': 'æ‰€æœ‰ SIP å®šæ—¶å™¨å·²å¯åŠ¨',
                'CDR system initialized': 'CDR è¯å•ç³»ç»Ÿå·²åˆå§‹åŒ–',
                'WebSocket connection established': 'WebSocket è¿æ¥å·²å»ºç«‹',
                'REGISTER': 'æ³¨å†Œ',
                'INVITE': 'å‘¼å«é‚€è¯·',
                'BYE': 'ç»“æŸé€šè¯',
                'MESSAGE': 'æ¶ˆæ¯',
                'ACK': 'ç¡®è®¤',
                'CANCEL': 'å–æ¶ˆ',
                'OPTIONS': 'é€‰é¡¹æŸ¥è¯¢',
                'Received': 'æ¥æ”¶',
                'Sent': 'å‘é€',
                'Failed': 'å¤±è´¥',
                'Success': 'æˆåŠŸ',
                'Error': 'é”™è¯¯',
                'Warning': 'è­¦å‘Š',
                'Info': 'ä¿¡æ¯'
            };
            
            let translated = message;
            for (const [en, cn] of Object.entries(translations)) {
                translated = translated.replace(new RegExp(en, 'gi'), cn);
            }
            
            return translated;
        }

        // æœç´¢å‘½ä»¤
        document.getElementById('tree-search').addEventListener('input', (e) => {
            const keyword = e.target.value.toLowerCase();
            const items = document.querySelectorAll('.command-item');

            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                const cmd = item.dataset.command.toLowerCase();

                if (text.includes(keyword) || cmd.includes(keyword)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // è¾“å…¥æ¡†ç„¦ç‚¹
        const inputWrapper = document.getElementById('command-input-wrapper');
        const commandInput = document.getElementById('command-input');

        commandInput.addEventListener('focus', () => {
            inputWrapper.classList.add('focused');
        });

        commandInput.addEventListener('blur', () => {
            inputWrapper.classList.remove('focused');
        });

        // å‘½ä»¤å†å²
        commandInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                executeCommand();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    commandInput.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    commandInput.value = commandHistory[historyIndex];
                } else if (historyIndex === 0) {
                    historyIndex = -1;
                    commandInput.value = '';
                }
            }
        });

        // æ‰§è¡ŒæŒ‰é’®
        document.getElementById('execute-btn').addEventListener('click', executeCommand);
        
        // è¡¥å…¨æŒ‰é’® - è§£æå‘½ä»¤å¹¶å¡«å……åˆ°å‚æ•°è¡¨å•
        document.getElementById('parse-btn').addEventListener('click', () => {
            const command = document.getElementById('command-input').value.trim().toUpperCase();
            
            if (!command) {
                appendOutput('', 'è¯·å…ˆè¾“å…¥ MML å‘½ä»¤', 'error');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…å·²é…ç½®çš„å‘½ä»¤
            let matchedConfig = null;
            for (const [cmdPattern, config] of Object.entries(commandParamConfigs)) {
                if (command.startsWith(cmdPattern)) {
                    matchedConfig = { pattern: cmdPattern, config };
                    break;
                }
            }
            
            if (matchedConfig) {
                // æ˜¾ç¤ºå‚æ•°è¡¨å•
                showParamForm(matchedConfig.pattern, matchedConfig.config);
                
                // ä»å‘½ä»¤æ–‡æœ¬è§£æå‚æ•°å¹¶å¡«å……åˆ°è¡¨å•
                parseCommandToForm(command, matchedConfig.pattern);
                
                appendOutput('è¡¥å…¨', `å‘½ä»¤å·²è§£æå¹¶å¡«å……åˆ°å‚æ•°è¡¨å•: ${command}`, 'success');
            } else {
                appendOutput('è¡¥å…¨', `è¯¥å‘½ä»¤ä¸æ”¯æŒå‚æ•°è¡¨å•: ${command}`, 'error');
            }
        });
        
        // å·¦ä¾§è¾¹æ æ”¶èµ·/å±•å¼€
        let leftPanelCollapsed = false;
        const leftExpandBtn = document.getElementById('left-expand-btn');
        
        function toggleLeftPanel() {
            const panel = document.getElementById('command-tree-panel');
            const resizer = document.getElementById('left-resizer');
            const btn = document.getElementById('toggle-left-panel');
            
            if (leftPanelCollapsed) {
                // å±•å¼€
                panel.classList.remove('collapsed');
                resizer.classList.remove('collapsed');
                leftExpandBtn.classList.remove('show');
                btn.textContent = 'â—€';
                btn.title = 'æ”¶èµ·å‘½ä»¤ç›®å½•';
                leftPanelCollapsed = false;
            } else {
                // æ”¶èµ·
                panel.classList.add('collapsed');
                resizer.classList.add('collapsed');
                leftExpandBtn.classList.add('show');
                btn.textContent = 'â–¶';
                btn.title = 'å±•å¼€å‘½ä»¤ç›®å½•';
                leftPanelCollapsed = true;
            }
        }
        
        document.getElementById('toggle-left-panel').addEventListener('click', toggleLeftPanel);
        leftExpandBtn.addEventListener('click', toggleLeftPanel);
        
        // å³ä¾§è¾¹æ æ”¶èµ·/å±•å¼€
        let rightPanelCollapsed = false;
        const rightExpandBtn = document.getElementById('right-expand-btn');
        
        function toggleRightPanel() {
            const panel = document.getElementById('log-panel');
            const resizer = document.getElementById('right-resizer');
            const btn = document.getElementById('toggle-right-panel');
            
            if (rightPanelCollapsed) {
                // å±•å¼€
                panel.classList.remove('collapsed');
                resizer.classList.remove('collapsed');
                rightExpandBtn.classList.remove('show');
                btn.textContent = 'â–¶';
                btn.title = 'æ”¶èµ·æ—¥å¿—é¢æ¿';
                rightPanelCollapsed = false;
            } else {
                // æ”¶èµ·
                panel.classList.add('collapsed');
                resizer.classList.add('collapsed');
                rightExpandBtn.classList.add('show');
                btn.textContent = 'â—€';
                btn.title = 'å±•å¼€æ—¥å¿—é¢æ¿';
                rightPanelCollapsed = true;
            }
        }
        
        document.getElementById('toggle-right-panel').addEventListener('click', toggleRightPanel);
        rightExpandBtn.addEventListener('click', toggleRightPanel);

        // æ—¥å¿—æ§åˆ¶
        document.getElementById('clear-log-btn').addEventListener('click', () => {
            const logContent = document.getElementById('log-content');
            logContent.innerHTML = '';
            appendLog('æ—¥å¿—å·²æ¸…ç©º', 'INFO');
        });

        document.getElementById('pause-log-btn').addEventListener('click', (e) => {
            logPaused = !logPaused;
            e.target.textContent = logPaused ? 'ç»§ç»­' : 'æš‚åœ';
            appendLog(logPaused ? 'æ—¥å¿—å·²æš‚åœ' : 'æ—¥å¿—å·²ç»§ç»­', 'INFO');
        });

        // WebSocket è¿æ¥ï¼ˆå®æ—¶æ—¥å¿—ï¼‰
        function connectWebSocket() {
            try {
                ws = new WebSocket('ws://localhost:8889');

                ws.onopen = () => {
                    appendLog('WebSocket è¿æ¥å·²å»ºç«‹', 'INFO');
                };

                ws.onmessage = (event) => {
                    // æœåŠ¡å™¨å‘é€çº¯æ–‡æœ¬æ ¼å¼: [LEVEL] message
                    const text = event.data;
                    
                    // æå–æ—¥å¿—çº§åˆ«å’Œæ¶ˆæ¯
                    const match = text.match(/^\[(\w+)\]\s*(.+)$/);
                    if (match) {
                        const level = match[1];  // INFO, DEBUG, WARNING, ERROR
                        const message = match[2];
                        appendLog(message, level);
                    } else {
                        // å¦‚æœæ ¼å¼ä¸åŒ¹é…ï¼Œç›´æ¥æ˜¾ç¤º
                        appendLog(text, 'INFO');
                    }
                };

                ws.onerror = () => {
                    appendLog('WebSocket è¿æ¥é”™è¯¯ï¼ˆå®æ—¶æ—¥å¿—ä¸å¯ç”¨ï¼‰', 'WARNING');
                };

                ws.onclose = () => {
                    appendLog('WebSocket è¿æ¥å·²å…³é—­', 'WARNING');
                };
            } catch (error) {
                console.error('WebSocket ä¸å¯ç”¨:', error);
            }
        }

        // é¢æ¿æ‹–åŠ¨è°ƒæ•´å¤§å°åŠŸèƒ½
        function initResizers() {
            // å·¦ä¾§é¢æ¿æ‹–åŠ¨
            const leftResizer = document.getElementById('left-resizer');
            const leftPanel = document.getElementById('command-tree-panel');
            
            leftResizer.addEventListener('mousedown', (e) => {
                e.preventDefault();
                const startX = e.clientX;
                const startWidth = leftPanel.offsetWidth;
                let rafId = null;
                let currentWidth = startWidth;
                
                function onMouseMove(e) {
                    const newWidth = startWidth + (e.clientX - startX);
                    // æœ€å°40pxï¼ˆæ”¶èµ·çŠ¶æ€ï¼‰ï¼Œæœ€å¤§ä¸é™åˆ¶
                    if (newWidth >= 40) {
                        currentWidth = newWidth;
                        
                        // ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–æ€§èƒ½
                        if (rafId) {
                            cancelAnimationFrame(rafId);
                        }
                        rafId = requestAnimationFrame(() => {
                            leftPanel.style.width = currentWidth + 'px';
                        });
                    }
                }
                
                function onMouseUp() {
                    if (rafId) {
                        cancelAnimationFrame(rafId);
                    }
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                }
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
            
            // å³ä¾§é¢æ¿æ‹–åŠ¨
            const rightResizer = document.getElementById('right-resizer');
            const rightPanel = document.getElementById('log-panel');
            
            rightResizer.addEventListener('mousedown', (e) => {
                e.preventDefault();
                const startX = e.clientX;
                const startWidth = rightPanel.offsetWidth;
                let rafId = null;
                let currentWidth = startWidth;
                
                function onMouseMove(e) {
                    const newWidth = startWidth - (e.clientX - startX);
                    // æœ€å°40pxï¼ˆæ”¶èµ·çŠ¶æ€ï¼‰ï¼Œæœ€å¤§ä¸é™åˆ¶
                    if (newWidth >= 40) {
                        currentWidth = newWidth;
                        
                        // ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–æ€§èƒ½
                        if (rafId) {
                            cancelAnimationFrame(rafId);
                        }
                        rafId = requestAnimationFrame(() => {
                            rightPanel.style.width = currentWidth + 'px';
                        });
                    }
                }
                
                function onMouseUp() {
                    if (rafId) {
                        cancelAnimationFrame(rafId);
                    }
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                }
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
            
            // æ°´å¹³æ‹–åŠ¨ï¼ˆè¾“å‡ºåŒºåŸŸå’Œè¾“å…¥åŒºåŸŸï¼‰
            const horizontalResizer = document.getElementById('horizontal-resizer');
            const outputArea = document.getElementById('output-area');
            const inputArea = document.getElementById('input-area');
            
            horizontalResizer.addEventListener('mousedown', (e) => {
                e.preventDefault();
                const startY = e.clientY;
                const startHeight = inputArea.offsetHeight;
                let rafId = null;
                let currentHeight = startHeight;
                
                function onMouseMove(e) {
                    const newHeight = startHeight - (e.clientY - startY);
                    if (newHeight >= 50 && newHeight <= 600) {
                        currentHeight = newHeight;
                        
                        // ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–æ€§èƒ½
                        if (rafId) {
                            cancelAnimationFrame(rafId);
                        }
                        rafId = requestAnimationFrame(() => {
                            inputArea.style.height = currentHeight + 'px';
                            // å‚æ•°è¡¨å•ä½¿ç”¨ flex: 1 è‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒæ•´
                        });
                    }
                }
                
                function onMouseUp() {
                    if (rafId) {
                        cancelAnimationFrame(rafId);
                    }
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                }
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
        }
        
        // å‘½ä»¤å‚æ•°è¡¨å•é…ç½®
        const commandParamConfigs = {
            // æ—¥å¿—çº§åˆ«è®¾ç½®å‘½ä»¤ï¼ˆæ”¯æŒä¸¤ç§æ ¼å¼ï¼‰
            'SET LOGLEVEL': [
                { name: 'LEVEL', label: 'æ—¥å¿—çº§åˆ«', required: true, type: 'select', options: ['DEBUG', 'INFO', 'WARNING', 'ERROR'] }
            ],
            'SET LOG': [
                { name: 'LEVEL', label: 'æ—¥å¿—çº§åˆ«', required: true, type: 'select', options: ['DEBUG', 'INFO', 'WARNING', 'ERROR'] }
            ],
            // æŸ¥è¯¢æ³¨å†Œå‘½ä»¤
            'DSP REG': [
                { name: 'URI', label: 'ç”¨æˆ·URI', required: false, placeholder: 'å¦‚: 1001 æˆ– sip:1001@domain' }
            ],
            // å¼ºåˆ¶æ³¨é”€å‘½ä»¤
            'RMV REG': [
                { name: 'URI', label: 'ç”¨æˆ·URI', required: true, placeholder: 'å¦‚: 1001 æˆ– sip:1001@domain' },
                { name: 'CONFIRM', label: 'ç¡®è®¤', required: true, type: 'select', options: ['YES', 'NO'] }
            ],
            // æ¸…é™¤æ‰€æœ‰æ³¨å†Œå‘½ä»¤
            'CLR REG': [
                { name: 'CONFIRM', label: 'ç¡®è®¤', required: true, type: 'select', options: ['YES', 'NO'] }
            ],
            // å‘¼å«ç®¡ç†å‘½ä»¤
            'DSP CALL': [
                { name: 'CALLID', label: 'Call-ID', required: false, placeholder: 'ç•™ç©ºæŸ¥è¯¢æ‰€æœ‰æ´»è·ƒå‘¼å«ï¼Œå¡«å†™åˆ™æŸ¥è¯¢æŒ‡å®šå‘¼å«' }
            ],
            'RMV CALL': [
                { name: 'CALLID', label: 'Call-ID', required: true, placeholder: 'è¦æŒ‚æ–­çš„å‘¼å« Call-ID' },
                { name: 'CONFIRM', label: 'ç¡®è®¤', required: true, type: 'select', options: ['YES', 'NO'] }
            ],
            'CLR CALL': [
                { name: 'CONFIRM', label: 'ç¡®è®¤', required: true, type: 'select', options: ['YES', 'NO'] }
            ],
            // æ€§èƒ½ç›‘æ§å‘½ä»¤
            'DSP PERF': [
                { name: 'TYPE', label: 'ç›‘æ§ç±»å‹', required: false, type: 'select', options: ['ALL', 'CPU', 'MEM', 'NET', 'MSG'], placeholder: 'é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰æ€§èƒ½æŒ‡æ ‡' }
            ],
            // é…ç½®ç®¡ç†å‘½ä»¤
            'DSP CFG': [
                { name: 'KEY', label: 'é…ç½®é¡¹', required: false, placeholder: 'ç•™ç©ºæŸ¥è¯¢æ‰€æœ‰é…ç½®ï¼Œæˆ–è¾“å…¥é…ç½®é¡¹åç§°ï¼ˆå¦‚: LOG.LEVELï¼‰' },
                { name: 'CATEGORY', label: 'é…ç½®åˆ†ç±»', required: false, placeholder: 'ç•™ç©ºæŸ¥è¯¢æ‰€æœ‰åˆ†ç±»ï¼Œæˆ–è¾“å…¥åˆ†ç±»åç§°' }
            ],
            'SET CFG': [
                { name: 'KEY', label: 'é…ç½®é¡¹', required: false, type: 'select', options: ['LOG.LEVEL'], placeholder: 'é€‰æ‹©è¦ä¿®æ”¹çš„é…ç½®é¡¹' },
                { name: 'VALUE', label: 'æ–°å€¼', required: true, type: 'select', options: ['DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL'], placeholder: 'é€‰æ‹©æ–°çš„æ—¥å¿—çº§åˆ«' }
            ],
            'EXP CFG': [
                // æ— éœ€å‚æ•°
            ],
            // CDR ç®¡ç†å‘½ä»¤
            'DSP CDR': [
                { name: 'DATE', label: 'æ—¥æœŸ', required: false, placeholder: 'æ ¼å¼: YYYY-MM-DD æˆ– TODAYï¼Œç•™ç©ºä¸ºä»Šå¤©' },
                { name: 'TYPE', label: 'è®°å½•ç±»å‹', required: false, type: 'select', options: ['CALL', 'REGISTER', 'MESSAGE', 'OPTIONS'] },
                { name: 'LIMIT', label: 'æ˜¾ç¤ºæ¡æ•°', required: false, placeholder: 'é»˜è®¤ 50 æ¡' }
            ],
            'EXP CDR': [
                { name: 'DATE', label: 'æ—¥æœŸ', required: false, placeholder: 'æ ¼å¼: YYYY-MM-DD æˆ– TODAYï¼Œç•™ç©ºä¸ºä»Šå¤©' },
                { name: 'TYPE', label: 'è®°å½•ç±»å‹', required: false, type: 'select', options: ['CALL', 'REGISTER', 'MESSAGE', 'OPTIONS'] },
                { name: 'FORMAT', label: 'å¯¼å‡ºæ ¼å¼', required: false, type: 'select', options: ['CSV'] }
            ],
            'CLR CDR': [
                { name: 'BEFORE', label: 'åˆ é™¤æ­¤æ—¥æœŸä¹‹å‰çš„æ•°æ®', required: true, placeholder: 'æ ¼å¼: YYYY-MM-DD (è‡³å°‘7å¤©å‰)' },
                { name: 'CONFIRM', label: 'ç¡®è®¤', required: true, type: 'select', options: ['YES', 'NO'] }
            ],
            // æŸ¥è¯¢ç”¨æˆ·å‘½ä»¤
            'DSP USER': [
                { name: 'USERNAME', label: 'ç”¨æˆ·å', required: false, placeholder: 'ç•™ç©ºæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·' },
                { name: 'STATUS', label: 'çŠ¶æ€', required: false, type: 'select', options: ['ACTIVE', 'INACTIVE', 'SUSPENDED'] }
            ],
            // æ”¯æŒ ADD USR å’Œ ADD USER ä¸¤ç§å†™æ³•
            'ADD USER': [
                { name: 'USERNAME', label: 'ç”¨æˆ·å', required: true, placeholder: 'å¦‚: 1003' },
                { name: 'PASSWORD', label: 'å¯†ç ', required: true, placeholder: 'å¯†ç ', type: 'password' },
                { name: 'NAME', label: 'æ˜¾ç¤ºåç§°', required: false, placeholder: 'å¦‚: ç”¨æˆ·1003' },
                { name: 'PHONE', label: 'ç”µè¯å·ç ', required: false, placeholder: 'å¦‚: 13800001003' },
                { name: 'EMAIL', label: 'é‚®ç®±', required: false, placeholder: 'å¦‚: user@example.com' },
                { name: 'SERVICE', label: 'æœåŠ¡ç±»å‹', required: false, type: 'select', options: ['BASIC', 'PREMIUM', 'VIP'] }
            ],
            'ADD USR': [
                { name: 'USERNAME', label: 'ç”¨æˆ·å', required: true, placeholder: 'å¦‚: 1003' },
                { name: 'PASSWORD', label: 'å¯†ç ', required: true, placeholder: 'å¯†ç ', type: 'password' },
                { name: 'NAME', label: 'æ˜¾ç¤ºåç§°', required: false, placeholder: 'å¦‚: ç”¨æˆ·1003' },
                { name: 'PHONE', label: 'ç”µè¯å·ç ', required: false, placeholder: 'å¦‚: 13800001003' },
                { name: 'EMAIL', label: 'é‚®ç®±', required: false, placeholder: 'å¦‚: user@example.com' },
                { name: 'SERVICE', label: 'æœåŠ¡ç±»å‹', required: false, type: 'select', options: ['BASIC', 'PREMIUM', 'VIP'] }
            ],
            'MOD USER': [
                { name: 'USERNAME', label: 'ç”¨æˆ·å', required: true, placeholder: 'å¦‚: 1001' },
                { name: 'PASSWORD', label: 'æ–°å¯†ç ', required: false, placeholder: 'ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹' },
                { name: 'NAME', label: 'æ˜¾ç¤ºåç§°', required: false, placeholder: 'ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹' },
                { name: 'PHONE', label: 'ç”µè¯å·ç ', required: false, placeholder: 'ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹' },
                { name: 'EMAIL', label: 'é‚®ç®±', required: false, placeholder: 'ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹' },
                { name: 'SERVICE', label: 'æœåŠ¡ç±»å‹', required: false, type: 'select', options: ['BASIC', 'PREMIUM', 'VIP'] },
                { name: 'STATUS', label: 'çŠ¶æ€', required: false, type: 'select', options: ['ACTIVE', 'INACTIVE', 'SUSPENDED'] }
            ],
            'MOD USR': [
                { name: 'USERNAME', label: 'ç”¨æˆ·å', required: true, placeholder: 'å¦‚: 1001' },
                { name: 'PASSWORD', label: 'æ–°å¯†ç ', required: false, placeholder: 'ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹' },
                { name: 'NAME', label: 'æ˜¾ç¤ºåç§°', required: false, placeholder: 'ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹' },
                { name: 'PHONE', label: 'ç”µè¯å·ç ', required: false, placeholder: 'ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹' },
                { name: 'EMAIL', label: 'é‚®ç®±', required: false, placeholder: 'ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹' },
                { name: 'SERVICE', label: 'æœåŠ¡ç±»å‹', required: false, type: 'select', options: ['BASIC', 'PREMIUM', 'VIP'] },
                { name: 'STATUS', label: 'çŠ¶æ€', required: false, type: 'select', options: ['ACTIVE', 'INACTIVE', 'SUSPENDED'] }
            ],
            'RMV USER': [
                { name: 'USERNAME', label: 'ç”¨æˆ·å', required: true, placeholder: 'è¦åˆ é™¤çš„ç”¨æˆ·å' }
            ],
            'RMV USR': [
                { name: 'USERNAME', label: 'ç”¨æˆ·å', required: true, placeholder: 'è¦åˆ é™¤çš„ç”¨æˆ·å' }
            ]
        };
        
        // åŠ¨æ€å‚æ•°è¡¨å•åŠŸèƒ½
        function initParamForm() {
            const input = document.getElementById('command-input');
            const paramForm = document.getElementById('param-form');
            const paramFields = document.getElementById('param-form-fields');
            const resizer = document.getElementById('param-form-resizer');
            
            // ç›‘å¬å‘½ä»¤è¾“å…¥å˜åŒ–
            input.addEventListener('input', () => {
                checkAndShowParamForm();
            });
            
            // å‚æ•°è¡¨å•ç°åœ¨ä½¿ç”¨ flex: 1 è‡ªåŠ¨å¡«å……ç©ºé—´ï¼Œä¸å†éœ€è¦ç‹¬ç«‹çš„æ‹–åŠ¨è°ƒæ•´
            // ç”¨æˆ·å¯ä»¥é€šè¿‡æ‹–åŠ¨ input-area é¡¶éƒ¨çš„æ°´å¹³åˆ†éš”æ¡æ¥è°ƒæ•´æ•´ä¸ªè¾“å…¥åŒºåŸŸçš„é«˜åº¦
        }
        
        // æ£€æŸ¥å¹¶æ˜¾ç¤ºå‚æ•°è¡¨å•ï¼ˆç‹¬ç«‹å‡½æ•°ï¼Œå¯ä»¥è¢«å¤šå¤„è°ƒç”¨ï¼‰
        function checkAndShowParamForm() {
            const input = document.getElementById('command-input');
            const paramForm = document.getElementById('param-form');
            const command = input.value.trim().toUpperCase();
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…å·²é…ç½®çš„å‘½ä»¤
            let matchedConfig = null;
            for (const [cmdPattern, config] of Object.entries(commandParamConfigs)) {
                if (command.startsWith(cmdPattern)) {
                    matchedConfig = { pattern: cmdPattern, config };
                    break;
                }
            }
            
            if (matchedConfig) {
                // æ˜¾ç¤ºå‚æ•°è¡¨å•
                showParamForm(matchedConfig.pattern, matchedConfig.config);
                
                // ä»å‘½ä»¤æ–‡æœ¬è§£æå·²æœ‰å‚æ•°
                parseCommandToForm(command, matchedConfig.pattern);
            } else {
                // æ²¡æœ‰åŒ¹é…çš„å‘½ä»¤ï¼Œéšè—å‚æ•°è¡¨å•
                paramForm.style.display = 'none';
            }
        }
        
        function showParamForm(cmdPattern, config) {
            const paramForm = document.getElementById('param-form');
            const paramFields = document.getElementById('param-form-fields');
            
            // æ¸…ç©ºç°æœ‰å­—æ®µ
            paramFields.innerHTML = '';
            
            // ç”Ÿæˆå‚æ•°è¾“å…¥å­—æ®µ
            config.forEach(field => {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'param-field';
                
                const label = document.createElement('label');
                label.textContent = field.label;
                if (field.required) {
                    const required = document.createElement('span');
                    required.className = 'required';
                    required.textContent = ' *';
                    label.appendChild(required);
                }
                
                let inputElement;
                if (field.type === 'select' && field.options) {
                    inputElement = document.createElement('select');
                    const emptyOption = document.createElement('option');
                    emptyOption.value = '';
                    emptyOption.textContent = '-- è¯·é€‰æ‹© --';
                    inputElement.appendChild(emptyOption);
                    
                    field.options.forEach(opt => {
                        const option = document.createElement('option');
                        option.value = opt;
                        option.textContent = opt;
                        inputElement.appendChild(option);
                    });
                } else {
                    inputElement = document.createElement('input');
                    inputElement.type = field.type || 'text';
                    inputElement.placeholder = field.placeholder || '';
                }
                
                inputElement.dataset.paramName = field.name;
                inputElement.dataset.required = field.required;
                
                // ç›‘å¬å‚æ•°è¾“å…¥å˜åŒ–ï¼Œæ›´æ–°å‘½ä»¤æ–‡æœ¬
                inputElement.addEventListener('input', () => {
                    updateCommandFromForm(cmdPattern);
                });
                
                fieldDiv.appendChild(label);
                fieldDiv.appendChild(inputElement);
                paramFields.appendChild(fieldDiv);
            });
            
            paramForm.style.display = 'flex';
            
            // å‚æ•°è¡¨å•ç°åœ¨ä½¿ç”¨ flex: 1 è‡ªåŠ¨å¡«å…… input-area å‰©ä½™ç©ºé—´
            // ä¸å†éœ€è¦æ‰‹åŠ¨è®¾ç½®é«˜åº¦ï¼Œoverflow-y: auto ä¼šè‡ªåŠ¨æ˜¾ç¤ºæ»šåŠ¨æ¡
        }
        
        function parseCommandToForm(command, cmdPattern) {
            // ä»å‘½ä»¤æ–‡æœ¬è§£æå‚æ•°
            const paramFields = document.getElementById('param-form-fields');
            const inputs = paramFields.querySelectorAll('input, select');
            
            // è§£æå‚æ•°ï¼šUSERNAME=1003 PASSWORD=1003 ç­‰
            const paramRegex = /(\w+)=([^\s]+)/g;
            const params = {};
            let match;
            while ((match = paramRegex.exec(command)) !== null) {
                params[match[1]] = match[2];
            }
            
            // æ›´æ–°è¡¨å•å­—æ®µ
            inputs.forEach(input => {
                const paramName = input.dataset.paramName;
                if (params[paramName]) {
                    input.value = params[paramName];
                }
            });
        }
        
        function updateCommandFromForm(cmdPattern) {
            const paramFields = document.getElementById('param-form-fields');
            const inputs = paramFields.querySelectorAll('input, select');
            const commandInput = document.getElementById('command-input');
            
            // æ”¶é›†å‚æ•°
            const params = [];
            inputs.forEach(input => {
                const paramName = input.dataset.paramName;
                const value = input.value.trim();
                
                if (value) {
                    params.push(`${paramName}=${value}`);
                }
            });
            
            // æ›´æ–°å‘½ä»¤æ–‡æœ¬
            let newCommand = cmdPattern;
            if (params.length > 0) {
                newCommand += ' ' + params.join(' ');
            }
            
            commandInput.value = newCommand;
        }
        
        // å‘½ä»¤è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½
        function initAutocomplete() {
            const input = document.getElementById('command-input');
            const dropdown = document.getElementById('autocomplete-dropdown');
            
            input.addEventListener('input', () => {
                const value = input.value.trim().toUpperCase();
                
                if (value.length === 0) {
                    dropdown.style.display = 'none';
                    autocompleteIndex = -1;
                    return;
                }
                
                // æŸ¥æ‰¾åŒ¹é…çš„å‘½ä»¤
                const matches = allCommands.filter(cmd => {
                    return cmd.command.toUpperCase().includes(value) ||
                           cmd.name.toUpperCase().includes(value);
                }).slice(0, 10);  // æœ€å¤šæ˜¾ç¤º10ä¸ª
                
                if (matches.length === 0) {
                    dropdown.style.display = 'none';
                    autocompleteIndex = -1;
                    return;
                }
                
                // æ¸²æŸ“åŒ¹é…ç»“æœ
                dropdown.innerHTML = '';
                matches.forEach((cmd, index) => {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.innerHTML = `
                        <span class="command-name">${cmd.command}</span>
                        <span class="command-desc">${cmd.name} - ${cmd.category}</span>
                    `;
                    
                    item.addEventListener('click', () => {
                        input.value = cmd.command;
                        dropdown.style.display = 'none';
                        autocompleteIndex = -1;
                        input.focus();
                    });
                    
                    dropdown.appendChild(item);
                });
                
                dropdown.style.display = 'block';
                autocompleteIndex = -1;
            });
            
            // é”®ç›˜å¯¼èˆª
            input.addEventListener('keydown', (e) => {
                const items = dropdown.querySelectorAll('.autocomplete-item');
                
                if (items.length === 0) return;
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    autocompleteIndex = Math.min(autocompleteIndex + 1, items.length - 1);
                    updateAutocompleteSelection(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    autocompleteIndex = Math.max(autocompleteIndex - 1, -1);
                    updateAutocompleteSelection(items);
                } else if (e.key === 'Enter' && autocompleteIndex >= 0) {
                    e.preventDefault();
                    items[autocompleteIndex].click();
                } else if (e.key === 'Escape') {
                    dropdown.style.display = 'none';
                    autocompleteIndex = -1;
                }
            });
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰æ¡†
            document.addEventListener('click', (e) => {
                if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.style.display = 'none';
                    autocompleteIndex = -1;
                }
            });
        }
        
        function updateAutocompleteSelection(items) {
            items.forEach((item, index) => {
                if (index === autocompleteIndex) {
                    item.classList.add('selected');
                    item.scrollIntoView({ block: 'nearest' });
                } else {
                    item.classList.remove('selected');
                }
            });
        }
        
        // åˆå§‹åŒ–
        // é¡µç­¾åˆ‡æ¢
        function initOutputTabs() {
            const currentTab = document.getElementById('current-tab');
            const historyTab = document.getElementById('history-tab');
            const outputContent = document.getElementById('output-content');
            const historyContent = document.getElementById('history-content');
            
            currentTab.addEventListener('click', () => {
                currentTab.classList.add('active');
                historyTab.classList.remove('active');
                outputContent.style.display = 'block';
                historyContent.style.display = 'none';
            });
            
            historyTab.addEventListener('click', () => {
                historyTab.classList.add('active');
                currentTab.classList.remove('active');
                historyContent.style.display = 'flex';
                outputContent.style.display = 'none';
            });
        }
        
        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function updateHistoryDisplay() {
            const historyList = document.getElementById('history-list');
            
            if (commandHistoryDetails.length === 0) {
                historyList.innerHTML = '<p style="color: #858585; text-align: center; margin-top: 50px;">æš‚æ— å†å²è®°å½•</p>';
                return;
            }
            
            historyList.innerHTML = '';
            
            commandHistoryDetails.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'history-item';
                itemDiv.dataset.id = item.id;
                
                // æˆªå–è¾“å‡ºçš„å‰80ä¸ªå­—ç¬¦ä½œä¸ºé¢„è§ˆ
                const preview = item.output.split('\n')[0].substring(0, 80) + 
                               (item.output.length > 80 ? '...' : '');
                
                itemDiv.innerHTML = `
                    <div class="history-item-header">
                        <span class="history-item-command">${escapeHtml(item.command)}</span>
                        <span class="history-item-time">${item.timestamp}</span>
                    </div>
                    <div class="history-item-result">${escapeHtml(preview)}</div>
                `;
                
                itemDiv.addEventListener('click', () => {
                    // ç§»é™¤ä¹‹å‰çš„é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('.history-item').forEach(el => {
                        el.classList.remove('selected');
                    });
                    itemDiv.classList.add('selected');
                    
                    // åœ¨å†å²è¯¦æƒ…åŒºåŸŸæ˜¾ç¤ºå®Œæ•´ç»“æœ
                    const historyDetail = document.getElementById('history-detail');
                    historyDetail.classList.add('show');
                    historyDetail.innerHTML = `
                        <div class="output-entry">
                            <div class="output-time">[å†å²è®°å½•] ${item.timestamp}</div>
                            <div class="output-command">MML> ${escapeHtml(item.command)}</div>
                            <div class="output-${item.status}">${escapeHtml(item.output)}</div>
                        </div>
                    `;
                    
                    // æ»šåŠ¨åˆ°é¡¶éƒ¨
                    historyDetail.scrollTop = 0;
                });
                
                historyList.appendChild(itemDiv);
            });
        }
        
        // æ›´æ–°å†å²æŒ‰é’®çŠ¶æ€
        function updateHistoryButtons() {
            const prevBtn = document.getElementById('history-prev-btn');
            const nextBtn = document.getElementById('history-next-btn');
            
            prevBtn.disabled = historyIndex >= commandHistory.length - 1;
            nextBtn.disabled = historyIndex <= -1;
        }
        
        // å†å²å¯¼èˆª
        function initHistoryNavigation() {
            const prevBtn = document.getElementById('history-prev-btn');
            const nextBtn = document.getElementById('history-next-btn');
            const input = document.getElementById('command-input');
            
            // ä¸Šä¸€æ¡å‘½ä»¤
            prevBtn.addEventListener('click', () => {
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    input.value = commandHistory[historyIndex];
                    updateHistoryButtons();
                }
            });
            
            // ä¸‹ä¸€æ¡å‘½ä»¤
            nextBtn.addEventListener('click', () => {
                if (historyIndex > -1) {
                    historyIndex--;
                    if (historyIndex === -1) {
                        input.value = '';
                    } else {
                        input.value = commandHistory[historyIndex];
                    }
                    updateHistoryButtons();
                }
            });
            
            // é”®ç›˜å¿«æ·é”®ï¼šâ†‘ å’Œ â†“
            input.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    prevBtn.click();
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    nextBtn.click();
                }
            });
            
            // åˆå§‹çŠ¶æ€
            updateHistoryButtons();
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadCommandTree();
            connectWebSocket();
            initResizers();
            initAutocomplete();
            initParamForm();
            initOutputTabs();
            initHistoryNavigation();
        });
    </script>
</body>
</html>

